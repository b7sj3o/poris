import{p as w,a as $,_ as I}from"./params.d089f16f.js";import{m,t as u}from"./functions.e62da874.js";import"./_commonjsHelpers.442273fa.js";const{__:_}=wp.i18n;var g,y="clearence",E=0,x=0,b={},O={},A=new IntersectionObserver(async t=>{if(g||t[0].intersectionRatio<=0)return;g=await(await fetch(theme.api.endpoint+"adream/v1/auctions")).json()});document.getElementById("formCalcShipping")&&A.observe(document.getElementById("formCalcShipping"));const P=t=>{const n=document.getElementById("auction"),e=document.getElementById("auctionCity");if(document.getElementById("costOfTheCar"),!e||!n)return;if(!g){setTimeout(P,1e3);return}e.innerHTML="",e.tomselect&&(e.tomselect.clear(),e.tomselect.clearOptions()),g.auctions.find(o=>o.name==n.value).price.forEach(o=>{let i=document.createElement("option");i.setAttribute("value",o.price),i.dataset.port=o.port,i.innerHTML=o.city,i.value=o.city,e.insertAdjacentElement("beforeend",i)}),e.tomselect&&(e.tomselect.sync(),e.tomselect.enable())},C=()=>{const t=document.getElementById("auctionCity"),n=document.getElementById("portFrom"),e=document.getElementById("portTo");if(!n||!t||!e)return;if(!g){setTimeout(C,1e3);return}const c=t.options[t.selectedIndex].dataset.port;n.value=c},j=()=>{const t=document.getElementById("turnkeyService");t.parentNode.classList.toggle("hidden"),t.toggleAttribute("required"),t.value=""};var L;(L=document.getElementById("turnkeyServiceCheckbox"))==null||L.addEventListener("input",j);var B;(B=document.getElementById("auction"))==null||B.addEventListener("input",P);var T;(T=document.getElementById("auctionCity"))==null||T.addEventListener("input",C);var S;(S=document.getElementById("engineType"))==null||S.addEventListener("input",M);function M(t){const n=document.getElementById("engineVolume"),e=document.getElementById("enginePower");t.target.value=="electric"?(n.parentNode.classList.add("hidden"),e.parentNode.classList.remove("hidden"),e.setAttribute("required",!0)):(n.parentNode.classList.remove("hidden"),e.parentNode.classList.add("hidden"),e.removeAttribute("required"),e.value="")}[document.getElementById("engineVolume"),document.getElementById("enginePower")].forEach(t=>t.addEventListener("input",R));function R(t){const n=document.getElementById("engineParam");n.value=t.target.value}window.addEventListener("DOMContentLoaded",C);var k;(k=document.getElementById("formCalcClearence"))==null||k.addEventListener("submit",F);var D;(D=document.getElementById("formCalcShipping"))==null||D.addEventListener("submit",V);async function F(t){t.preventDefault();const n=t.target.querySelector('[type="submit"]'),e=new FormData(t.target);e.append("wpnonce",theme.api.nonce),e.set("costOfTheCar",m.from(e.get("costOfTheCar"))),e.delete("engineVolume"),e.delete("enginePower");let c=e;if(document.getElementById("formCalcShipping")){const a=new FormData(document.getElementById("formCalcShipping"));a.set("costOfTheCar",m.from(a.get("costOfTheCar"))),a.get("turnkeyService")?a.set("turnkeyService",m.from(a.get("turnkeyService"))):a.set("turnkeyService",0);const d=document.getElementById("auctionCity");d&&a.set("auctionCity",d.options[d.selectedIndex].text),a.delete("isTurnkeyService"),e.delete("costOfTheCar");const l=new FormData;for(const[p,f]of e.entries())l.append(p,f);for(const[p,f]of a.entries())l.append(p,f);l.set("calcMode","all"),c=l}const o=new URLSearchParams(c),i=new Headers;i.append("Content-Type","application/x-www-form-urlencoded"),u(n),u(t.target);let r=await(await fetch(theme.api.endpoint+"adream/v1/calc?"+o,{method:"GET",headers:i})).json();if(r){document.getElementById("formCalcShipping")&&(E=r.payments_by.shipp_and_clearence.shipping.value,b=r.payments_by.shipp_and_clearence.shipping,v(r,"shipping")),x=r.payments_by.shipp_and_clearence.clearence.value,O=r.payments_by.shipp_and_clearence.clearence,v(r,"clearence");const a=new CustomEvent("calucalated_clearence");document.dispatchEvent(a)}else console.log("\u041D\u0415 \u041F\u0456\u0448\u043B\u043E");u(n),u(t.target)}async function V(t){t.preventDefault();const n=t.target.querySelector('[type="submit"]'),e=new FormData(t.target);e.append("wpnonce",theme.api.nonce),e.set("costOfTheCar",m.from(e.get("costOfTheCar"))),e.get("turnkeyService")?e.set("turnkeyService",m.from(e.get("turnkeyService"))):e.set("turnkeyService",0);const c=document.getElementById("auctionCity");c&&e.set("auctionCity",c.options[c.selectedIndex].text),e.delete("isTurnkeyService");const o=new URLSearchParams(e),i=new Headers;i.append("Content-Type","application/x-www-form-urlencoded"),u(n),u(t.target);let r=await(await fetch(theme.api.endpoint+"adream/v1/calc?"+o,{method:"GET",headers:i})).json();if(r){y="shipping",E=r.payments_by.shipp_and_clearence.shipping.value,b=r.payments_by.shipp_and_clearence.shipping,v(r,"shipping");const a=document.getElementById("customAutoValue");a&&(a.value=m.to(r.args.customAutoValue));const d=new CustomEvent("calucalated_shipping");document.dispatchEvent(d),console.log("\u041F\u0456\u0448\u043B\u043E")}else console.log("\u041D\u0415 \u041F\u0456\u0448\u043B\u043E");u(n),u(t.target)}function v(t,n){var i;const e=t.payments_by.shipp_and_clearence[n],c=document.getElementById(`${n}Calculations`);c.innerHTML="",e.subpayments.forEach((s,r)=>{if(s.value==0)return!1;let a="",d=1;for(const l in s.subpayments)a+=`
				<tr>
					<td class="pl-40 br-1-grey">${d}</td>
					<td class="br-1-grey">${s.subpayments[l].name}</td>
					<td id="${l}">${m.to(s.subpayments[l].value)}</td>
				</tr>
			`,d++;c.insertAdjacentHTML("beforeend",`
				<div class="calc-table calc-table-${r}">
					<table>
						<thead>
							<tr>
								<th colspan="3" class="w-full h3">${y=="clearence"?s.subname:s.name+". "+s.subname}</th>
							</tr>
						</thead>
						<tbody>
							${a}
							<tr>
								<td class="!text-base" colspan="2"><b>\u0420\u0430\u0437\u043E\u043C</b></td>
								<td class="!text-base">${m.to(s.value)}</td>
							</tr>
						</tbody>
					</table>
				</div>
			`)});let o="";if(t.notices.length&&(o+='<ul class="calc__notices">',(i=t.notices)==null||i.forEach(s=>{o+=`<li>${s}</li>`}),o+="</ul>"),y=="shipping"&&c.insertAdjacentHTML("beforeend",`
				<div class="calc-table calc-table-total">
					<div class="h3">
						${_("\u0420\u0430\u0437\u043E\u043C","frontenda-store-front")+" "+e.name}: <span>${m.to(e.value)}</span>
					</div>
					<div class="calc-notice">${o}</div>
				</div>
			`),n=="clearence"){c.insertAdjacentHTML("beforeend",`
				<div class="calc-table calc-table-total">
					<div class="h1">
						${_("\u0412\u0441\u044C\u043E\u0433\u043E","frontenda-store-front")}: <span>${m.to(E+x)}</span>
					</div>
				</div>
			`),t.shipping=b,t.clearence=O;const s=new CustomEvent("calucalated",{detail:{data:t}});document.dispatchEvent(s)}}document.addEventListener("calucalated_shipping",t=>{document.getElementById("shippingCalculations").classList.remove("hidden"),document.getElementById("sectionCalcClearence").classList.remove("hidden"),document.getElementById("shippingCalculations").scrollIntoView()});document.addEventListener("calucalated_clearence",t=>{document.getElementById("clearenceCalculations").classList.remove("hidden"),document.getElementById("clearenceCalculations").scrollIntoView()});document.addEventListener("calucalated",t=>{const n=t.detail.data;var e={Roboto:{normal:"https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.3.0-beta.1/fonts/Roboto/Roboto-Regular.ttf",bold:"https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.3.0-beta.1/fonts/Roboto/Roboto-Medium.ttf"}};w.addFonts(e),w.createPdf($(n)).getDataUrl().then(async c=>{const o=document.getElementById("iframeContainer");o.parentElement.parentElement.classList.remove("hidden");const i=document.createElement("iframe");i.src=c,o.innerHTML="",o.appendChild(i);const s=await I(()=>import("./pdf.cfde6e20.js").then(a=>a.p),["pdf.cfde6e20.js","_commonjsHelpers.442273fa.js"]),r=await I(()=>import("./pdf.worker.entry.03ad1a2b.js").then(a=>a.p),[]);s.GlobalWorkerOptions.workerSrc=r,s.getDocument(c).promise.then(function(a){a.getPage(1).then(function(d){const l=document.getElementById("pdf-canvas"),p=d.getViewport({scale:2});l.height=p.height,l.width=p.width,d.render({canvasContext:l.getContext("2d"),viewport:p}).promise.then(function(){const h=document.getElementById("btnDownloadCalculations");h.addEventListener("click",()=>{h.href=l.toDataURL("image/jpg",1),h.download="adream-"+n.total+"$.jpg"})})})})})});
